---
// Cookie Consent Banner Component
// Integrates with Google Analytics Consent Mode
---

<div
    id="cookie-consent-banner"
    class="fixed bottom-0 left-0 right-0 z-[9999] transform translate-y-full transition-transform duration-300 ease-out"
>
    <div class="max-w-7xl mx-auto p-4">
        <div
            class="bg-surface border border-border rounded-xl p-4 md:p-6 shadow-2xl shadow-black/20"
        >
            <div class="flex flex-col md:flex-row md:items-center gap-4">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <iconify-icon
                            icon="lucide:cookie"
                            width="20"
                            class="text-emerald-400"
                        ></iconify-icon>
                        <h3 class="text-white font-semibold">Cookie Preferences</h3>
                    </div>
                    <p class="text-neutral-400 text-sm leading-relaxed">
                        We use cookies to enhance your browsing experience and analyze our traffic.
                        By clicking "Accept All", you consent to our use of cookies as described in our
                        <a href="/privacy" class="text-emerald-400 hover:text-emerald-300 underline">Privacy Policy</a>.
                    </p>
                </div>
                <div class="flex flex-col sm:flex-row gap-2">
                    <button
                        id="cookie-reject"
                        class="px-4 py-2 text-sm font-medium text-neutral-300 border border-border rounded-lg hover:bg-neutral-800 transition-colors"
                    >
                        Reject All
                    </button>
                    <button
                        id="cookie-accept"
                        class="px-4 py-2 text-sm font-medium text-white bg-emerald-500 rounded-lg hover:bg-emerald-400 transition-colors"
                    >
                        Accept All
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script is:inline>
    (function() {
        const banner = document.getElementById('cookie-consent-banner');
        const acceptBtn = document.getElementById('cookie-accept');
        const rejectBtn = document.getElementById('cookie-reject');

        // Check if user has already made a choice
        const savedConsent = localStorage.getItem('cookie-consent');

        if (!savedConsent && banner) {
            // Show banner after a short delay
            setTimeout(() => {
                banner.classList.remove('translate-y-full');
            }, 1000);
        }

        function hideBanner() {
            if (banner) {
                banner.classList.add('translate-y-full');
            }
        }

        function updateConsent(analytics, advertising) {
            // Save preference
            localStorage.setItem('cookie-consent', JSON.stringify({
                analytics: analytics,
                advertising: advertising,
                timestamp: new Date().toISOString()
            }));

            // Update Google Analytics consent mode
            if (typeof gtag === 'function') {
                gtag('consent', 'update', {
                    'analytics_storage': analytics ? 'granted' : 'denied',
                    'ad_storage': advertising ? 'granted' : 'denied',
                    'ad_user_data': advertising ? 'granted' : 'denied',
                    'ad_personalization': advertising ? 'granted' : 'denied'
                });
            }

            hideBanner();
        }

        if (acceptBtn) {
            acceptBtn.addEventListener('click', () => {
                updateConsent(true, true);
            });
        }

        if (rejectBtn) {
            rejectBtn.addEventListener('click', () => {
                updateConsent(false, false);
            });
        }
    })();
</script>
